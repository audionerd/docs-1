---
title: 'Spawn'
description: 'You can use spawn to run actors. Actors created with spawn are spawning actors, and actors created with invoke are invoking actors.'
---

Sometimes invoking [actors](actors.mdx) may not be flexible enough for your needs. For example, you might want to:

- Invoke child machines that last across several states (machines invoked with `invoke` are always tied to that state)
- Invoke a dynamic number of actors

You can do this by **spawning** an actor instead of invoking. Actors created by `spawnChild` (or the `spawn` helper function for `assign`) are **spawning actors**, and actors created with invoke are **invoking actors**.

:::tip
[Read about the difference between spawning and invoking actors](actors.mdx#invoking-and-spawning-actors).
:::

In most cases, prefer the `spawnChild` action creator, which spawns an actor with a configurable ID.

```ts
createMachine({
  entry: spawnChild(childMachine, {
    id: 'child'
  })
})
```

You can also use the `spawn` helper function within an `assign` created action, which allows you to store a reference to the spawned actor (an `ActorRef`) in the machine's `context`. However, if you use `spawn`, **make sure you remove the ActorRef from context to prevent memory leaks**.

```ts
const parentMachine = createMachine({
  entry: [
    assign({
      childMachineRef: ({ spawn }) => spawn(childMachine, { id: 'child' }),
    })
  ]
});
```

const childMachine = createMachine({
  /* ... */
});

const parentMachine = createMachine({
  entry: [
    assign({
      childMachineRef: () => spawn(childMachine),
    }),
  ],
});
```

In the example above, the spawned actor can now be referenced on the `context` of the machine. You can spawn as many actors as you need:

```ts
import { createMachine, spawn, assign } from 'xstate';

const childMachine = createMachine({
  /* ... */
});

const parentMachine = createMachine({
  entry: [
    assign({
      childMachineRefs: () => [
        // highlight-start
        spawn(childMachine),
        spawn(childMachine),
        spawn(childMachine),
        // highlight-end
      ],
    }),
  ],
});
```

## API

```ts
actions: assign({
  ref: ({ spawn }) => spawn(fromPromise(...), {
    id: 'some-id',
  })
})
```

- `spawn(actorBehavior, options?)`
  - `actorBehavior` - The behavior of the actor to spawn. This can be a function, promise, observable, or callback.
  - `options` - Options for spawning the actor.
    - `id` - The ID of the actor. This is used to reference the actor in the state machine.
    - `input`

## Source

- Inline: `spawn(fromPromise(...))`
- Referenced: `spawn('getUser')`
  - `.provide({ actors })`

## Lifecycle

- Created & started when spawned
- Stopped when the machine is stopped
- Can be manually stopped

## Stopping an actor

- `actions: stop('some-id')`

- Note this does not clear it from the `context`

## TypeScript

_Coming soon_

## Cheatsheet

_Coming soon_
