"use strict";(self.webpackChunkstately_docs=self.webpackChunkstately_docs||[]).push([[32261],{3905:(e,t,n)=>{n.r(t),n.d(t,{MDXContext:()=>c,MDXProvider:()=>d,mdx:()=>h,useMDXComponents:()=>m,withMDXComponents:()=>p});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var c=a.createContext({}),p=function(e){return function(t){var n=m(t.components);return a.createElement(e,i({},t,{components:n}))}},m=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},d=function(e){var t=m(e.components);return a.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},g=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,r=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=m(n),d=o,g=p["".concat(r,".").concat(d)]||p[d]||u[d]||i;return n?a.createElement(g,s(s({ref:t},c),{},{components:n})):a.createElement(g,s({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=g;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}g.displayName="MDXCreateElement"},93184:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const i={title:"Introducing: TypeScript typegen for XState",description:"XState\u2019s TypeScript experience just got an enormous upgrade - Typescript typegen, integrated with VS Code.",tags:["announcement","xstate","community","typescript","tutorial","vscode"],authors:["matt"],image:"/blog/2022-01-27-introducing-typegen.png",slug:"2022-01-27-introducing-typegen",date:new Date("2022-01-27T00:00:00.000Z")},r=void 0,s={permalink:"/statelyai-docs/blog/2022-01-27-introducing-typegen",editUrl:"https://github.com/statelyai/docs/edit/main/blog/2022-01-27-introducing-typegen/index.mdx",source:"@site/blog/2022-01-27-introducing-typegen/index.mdx",title:"Introducing: TypeScript typegen for XState",description:"XState\u2019s TypeScript experience just got an enormous upgrade - Typescript typegen, integrated with VS Code.",date:"2022-01-27T00:00:00.000Z",formattedDate:"January 27, 2022",tags:[{label:"announcement",permalink:"/statelyai-docs/blog/tags/announcement"},{label:"xstate",permalink:"/statelyai-docs/blog/tags/xstate"},{label:"community",permalink:"/statelyai-docs/blog/tags/community"},{label:"typescript",permalink:"/statelyai-docs/blog/tags/typescript"},{label:"tutorial",permalink:"/statelyai-docs/blog/tags/tutorial"},{label:"vscode",permalink:"/statelyai-docs/blog/tags/vscode"}],readingTime:4.98,hasTruncateMarker:!0,authors:[{name:"Matt Pocock",title:"Stately Team",url:"https://github.com/mattpocock",imageURL:"https://ascelcgzufjyvdzuplwo.supabase.co/storage/v1/object/public/avatars/matt.png",key:"matt"}],frontMatter:{title:"Introducing: TypeScript typegen for XState",description:"XState\u2019s TypeScript experience just got an enormous upgrade - Typescript typegen, integrated with VS Code.",tags:["announcement","xstate","community","typescript","tutorial","vscode"],authors:["matt"],image:"/blog/2022-01-27-introducing-typegen.png",slug:"2022-01-27-introducing-typegen",date:"2022-01-27T00:00:00.000Z"},prevItem:{title:"Stately Editor public beta",permalink:"/statelyai-docs/blog/2022-02-08-join-the-stately-editor-public-beta"},nextItem:{title:"What are the biggest benefits of state machines?",permalink:"/statelyai-docs/blog/2021-12-14-what-are-the-biggest-benefits-youve-had-from-using-state-machines"}},l={authorsImageUrls:[void 0]},c=[{value:"Getting Started",id:"getting-started",level:2},{value:"Typing improvements",id:"typing-improvements",level:2},{value:"Events in machine options",id:"events-in-machine-options",level:3},{value:"Autocomplete on machine options",id:"autocomplete-on-machine-options",level:3},{value:"Typing of promise-services",id:"typing-of-promise-services",level:3},{value:"Acknowledgements",id:"acknowledgements",level:2}],p={toc:c};function m(e){let{components:t,...n}=e;return(0,o.mdx)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("div",{style:{position:"relative",height:"0px",paddingBottom:"56.25%"}},(0,o.mdx)("iframe",{src:"https://www.loom.com/embed/1f90a1a454c7495ea755f044c394c54d",frameBorder:"0",allowFullScreen:!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"}})),(0,o.mdx)("p",null,(0,o.mdx)("strong",{parentName:"p"},"XState and TypeScript are a match made in heaven"),". TypeScript gives you type safety, and XState gives you logical safety. Together, they give you confidence that your code will do what you expect."),(0,o.mdx)("p",null,"However, we\u2019ve been hearing from the community for some time that the ",(0,o.mdx)("em",{parentName:"p"},"experience")," of using TypeScript with XState needed improving."),(0,o.mdx)("p",null,"Today's your lucky day. ",(0,o.mdx)("strong",{parentName:"p"},"XState\u2019s TypeScript experience just got an ",(0,o.mdx)("em",{parentName:"strong"},"enormous")," upgrade"),"."),(0,o.mdx)("p",null,"We have brought type generation into XState v4.29.0, and we\u2019re aiming for ",(0,o.mdx)("strong",{parentName:"p"},"perfect types on all parts of XState\u2019s API"),"."),(0,o.mdx)("p",null,"We\u2019re releasing typegen today as an opt-in beta. Be sure to check out the ",(0,o.mdx)("a",{parentName:"p",href:"https://xstate.js.org/docs/guides/typescript.html#known-limitations"},"known limitations")," section of the docs."),(0,o.mdx)("h2",{id:"getting-started"},"Getting Started"),(0,o.mdx)("p",null,"You can visit the ",(0,o.mdx)("a",{parentName:"p",href:"https://xstate.js.org/docs/guides/typescript.html#typegen"},"official docs")," for the full guide, or follow the instructions:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Download and install the ",(0,o.mdx)("a",{parentName:"p",href:"https://marketplace.visualstudio.com/items?itemName=statelyai.stately-vscode"},"VS Code extension"),".")),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("p",{parentName:"li"},"Open a new file and create a new machine, passing the schema attributes:"))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},'import { createMachine } from "xstate";\n\nconst machine = createMachine({\n  schema: {\n    context: {} as { value: string },\n    events: {} as { type: "FOO"; value: string } | { type: "BAR" },\n  },\n  initial: "a",\n  states: {\n    a: {\n      on: {\n        FOO: {\n          actions: "consoleLogValue",\n          target: "b",\n        },\n      },\n    },\n    b: {\n      entry: "consoleLogValueAgain",\n    },\n  },\n});\n')),(0,o.mdx)("ol",{start:3},(0,o.mdx)("li",{parentName:"ol"},"Add ",(0,o.mdx)("inlineCode",{parentName:"li"},"tsTypes: {}")," to the machine and save the file:")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-diff"},'const machine = createMachine({\n+ tsTypes: {},\n  schema: {\n    context: {} as { value: string },\n    events: {} as { type: "FOO"; value: string } | { type: "BAR" },\n  },\n  initial: "a",\n  states: {\n    /* ... */\n  },\n});\n')),(0,o.mdx)("ol",{start:4},(0,o.mdx)("li",{parentName:"ol"},"The extension should automatically add a generic to the machine:")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},'const machine = createMachine({\n  // This generic just got added!\n  tsTypes: {} as import("./filename.typegen").Typegen0,\n  /* ... */\n});\n')),(0,o.mdx)("ol",{start:5},(0,o.mdx)("li",{parentName:"ol"},"Add a second parameter into the ",(0,o.mdx)("inlineCode",{parentName:"li"},"createMachine")," call - this is where you implement the actions, services, guards and delays for the machine.")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},"const machine = createMachine(\n  {\n    /* ... */\n  },\n  {\n    actions: {\n      consoleLogValue: (context, event) => {\n        // Wow! event is typed to { type: 'FOO' }\n        console.log(event.value);\n      },\n      consoleLogValueAgain: (context, event) => {\n        // Wow! event is typed to { type: 'FOO' }\n        console.log(event.value);\n      },\n    },\n  }\n);\n")),(0,o.mdx)("h2",{id:"typing-improvements"},"Typing improvements"),(0,o.mdx)("p",null,"Let\u2019s get into the nitty-gritty and show you exactly what\u2019s improved."),(0,o.mdx)("h3",{id:"events-in-machine-options"},"Events in machine options"),(0,o.mdx)("p",null,"One of the most common pain points we heard from our community was using named actions, services and guards with TypeScript. The main reason is that you needed to write code like this:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},'createMachine(\n  {\n    schema: {\n      events: {} as { type: "FOO"; value: string } | { type: "BAR" },\n    },\n    on: {\n      FOO: {\n        actions: "myAction",\n      },\n    },\n  },\n  {\n    actions: {\n      myAction: (context, event) => {\n        /**\n         * TS don\'t know if the event is FOO or BAR,\n         * so we have to defensively check here\n         */\n        if (event.type === "FOO") {\n          /**\n           * Now we know that event.value\n           * is present on FOO, because\n           * we checked\n           */\n          console.log(event.value);\n        }\n      },\n    },\n  }\n);\n')),(0,o.mdx)("p",null,"The VS Code extension ",(0,o.mdx)("strong",{parentName:"p"},"statically analyzes your machine"),", and knows which events lead to which actions."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},"createMachine(\n  {\n    /* config */\n  },\n  {\n    actions: {\n      myAction: (context, event) => {\n        /**\n         * No more defensive check needed! event\n         * is typed to only the events that cause\n         * the action\n         */\n        console.log(event.value);\n      },\n    },\n  }\n);\n")),(0,o.mdx)("p",null,"This works for actions, services, guards and delays. It even works for ",(0,o.mdx)("strong",{parentName:"p"},"entry actions"),", another big pain point from the community."),(0,o.mdx)("p",null,"We\u2019re hoping this lets you cut hundreds of lines of useless defensive code."),(0,o.mdx)("h3",{id:"autocomplete-on-machine-options"},"Autocomplete on machine options"),(0,o.mdx)("p",null,"Another thing we\u2019ve been hearing from the community is that it\u2019s easy to make typos on machine options."),(0,o.mdx)("p",null,"Now, with typegen, you get ",(0,o.mdx)("strong",{parentName:"p"},"autocomplete on all machine options"),". The following code will error:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},'createMachine(\n  {\n    entry: ["sayHello"],\n  },\n  {\n    actions: {\n      /*\n       * This will error, because sayhello does not\n       * exist in the machine declaration above\n       */\n      sayhello: () => {},\n    },\n  }\n);\n')),(0,o.mdx)("p",null,"We\u2019ve also made it so any ",(0,o.mdx)("em",{parentName:"p"},"missing")," machine options will error when\nyou implement them later. So, in a React component:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-tsx"},'const machine = createMachine({\n  entry: ["sayHello"],\n});\n\nconst App = () => {\n  /**\n   * This will error, because you haven\'t implemented\n   * sayHello in your actions object\n   */\n  const [state, send] = useMachine(machine);\n};\n')),(0,o.mdx)("p",null,"That gives you 100% confidence that your machine has all the things it needs to work."),(0,o.mdx)("h3",{id:"typing-of-promise-services"},"Typing of promise-services"),(0,o.mdx)("p",null,"Using promise-based services might be the single biggest pain point with XState and TypeScript. We used to have an entire troubleshooting section in our docs dedicated to them."),(0,o.mdx)("p",null,"Now, you can ",(0,o.mdx)("strong",{parentName:"p"},"strongly type the results of promise-based services"),". Here\u2019s how:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-ts"},'createMachine(\n  {\n    schema: {\n      /**\n       * Pass the \'services\' attribute to schema,\n       * with all the names of your services and\n       * the data they return\n       */\n      services: {} as {\n        myService: {\n          // The data that gets returned from the service\n          data: { id: string };\n        };\n      },\n    },\n    invoke: {\n      src: "myService",\n      onDone: {\n        actions: "consoleLogId",\n      },\n    },\n  },\n  {\n    services: {\n      /**\n       * This service will now type error if it\n       * returns anything other than { id: string }\n       */\n      myService: async () => {\n        return {\n          id: "1",\n        };\n      },\n    },\n    actions: {\n      consoleLogId: (context, event) => {\n        /**\n         * This event now knows that it will\n         * receive a data attribute with { id: string }\n         */\n        console.log(event.data.id);\n      },\n    },\n  }\n);\n')),(0,o.mdx)("p",null,"This makes handling data return types in XState intuitive, easy and type-safe."),(0,o.mdx)("h2",{id:"acknowledgements"},"Acknowledgements"),(0,o.mdx)("p",null,"I want to thank my Stately colleague ",(0,o.mdx)("a",{parentName:"p",href:"https://twitter.com/AndaristRake"},"Andarist"),". His TypeScript wizardry, incredible attention to detail and deep love of open source helped make this possible. We\u2019ve literally been talking about this for 18 months - and it\u2019s finally here."))}m.isMDXComponent=!0}}]);